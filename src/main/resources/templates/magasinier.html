<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="fragments/layout :: head"></head>
<body>
    <div th:replace="fragments/layout :: main(content=~{::content}, pageTitle='Magasinier Dashboard')">
        <div th:fragment="content">
            <div th:replace="fragments/layout :: alertMessage"></div>

            <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                <div class="card-header bg-white border-bottom border-light p-0">
                    <ul class="nav nav-tabs nav-fill border-0" id="dashboardTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active py-3 fw-bold text-dark border-0 border-bottom-3 border-primary rounded-0"
                                    id="requests-to-process-tab" data-bs-toggle="tab" data-bs-target="#requests-to-process"
                                    type="button" role="tab" aria-controls="requests-to-process" aria-selected="true">
                                <i class="bi bi-card-checklist me-2"></i>Requests to Process
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link py-3 fw-bold text-dark border-0"
                                    id="receipts-history-tab" data-bs-toggle="tab" data-bs-target="#receipts-history"
                                    type="button" role="tab" aria-controls="receipts-history" aria-selected="false">
                                <i class="bi bi-clock-history me-2"></i>Receipts History
                            </button>
                        </li>
                    </ul>
                </div>

                <div class="card-body p-0">
                    <div class="tab-content" id="dashboardTabsContent">
                        <!-- Requests to Process Tab -->
                        <div class="tab-pane fade show active" id="requests-to-process" role="tabpanel" aria-labelledby="requests-to-process-tab">
                            <div class="table-responsive">
                                <table class="table table-hover align-middle mb-0">
                                    <thead class="bg-light">
                                        <tr class="text-muted text-uppercase small" style="letter-spacing: 0.5px;">
                                            <th class="ps-4 py-3">ID</th>
                                            <th class="py-3">Requester</th>
                                            <th class="py-3">Product(s)</th>
                                            <th class="py-3">Date</th>
                                            <th class="py-3">Status</th>
                                            <th class="py-3 text-end pe-4">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="request : ${requests}">
                                            <td class="ps-4 fw-semibold text-secondary" th:text="${request.demande.id}">#1</td>
                                            <td th:text="${request.demandeurName}">User Name</td>
                                            <td>
                                                <ul class="mb-0 ps-3" th:if="${#lists.isEmpty(request.demande.lignes) == false}">
                                                    <li th:each="line : ${request.demande.lignes}"
                                                        th:text="${line.produit.nom + ' (x' + line.quantiteDemandee + ')'}">Product (xQ)</li>
                                                </ul>
                                                <span th:if="${#lists.isEmpty(request.demande.lignes)}" class="text-muted small">No products</span>
                                            </td>
                                            <td th:text="${#temporals.format(request.demande.request_date, 'dd-MM-yyyy')}">2025-01-01</td>
                                            <td>
                                                <span class="badge bg-success text-white" th:text="${request.demande.etat_demande}">ACCEPTE_SG</span>
                                            </td>
                                            <td class="text-end pe-4">
                                                <form th:action="@{/magasinier/request/deliver/{id}(id=${request.demande.id})}" method="post" style="display:inline;">
                                                    <button type="submit" class="btn btn-sm btn-outline-success" onclick="return confirm('Mark this request as delivered?');">
                                                        <i class="bi bi-check-circle"></i> Confirm Delivery
                                                    </button>
                                                </form>
                                            </td>
                                        </tr>
                                        <tr th:if="${#lists.isEmpty(requests)}">
                                            <td colspan="6" class="text-center py-4 text-muted">No accepted requests to process.</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Receipts History Tab -->
                        <div class="tab-pane fade" id="receipts-history" role="tabpanel" aria-labelledby="receipts-history-tab">
                            <div class="p-4">
                                <h4 class="fw-bold">Receipts History</h4>
                                <p class="text-muted">Coming soon...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const tabButtons = document.querySelectorAll('#dashboardTabs .nav-link');
            tabButtons.forEach(button => {
                button.addEventListener('click', function () {
                    tabButtons.forEach(btn => {
                        btn.classList.remove('active', 'border-primary');
                        btn.setAttribute('aria-selected', 'false');
                    });
                    this.classList.add('active', 'border-primary');
                    this.setAttribute('aria-selected', 'true');
                });
            });
        });
    </script>
</body>
</html>
